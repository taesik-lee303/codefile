deeplabs@raspberrypi:~/DeepCare-Device/deepcare/src $ pip install adafruit-circuitpython-ili9341 pillow
error: externally-managed-environment

× This environment is externally managed
╰─> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    For more information visit http://rptl.io/venv

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.


2025.06.07 camera error
aisl@gateway-529:~/deepcare/sensors $ python3 rppg-test-code.py
✓ rPPG modules found
=== Starting Integrated Face Detection and rPPG Tests ===
OpenCV version: 4.6.0

=== Initializing Camera ===
[2:13:27.207973520] [4857]  INFO Camera camera_manager.cpp:326 libcamera v0.5.0+59-d83ff0a4
[2:13:27.215288019] [4863]  INFO RPI pisp.cpp:720 libpisp version v1.2.1 981977ff21f3 29-04-2025 (14:13:50)
[2:13:27.225500028] [4863]  INFO RPI pisp.cpp:1179 Registered camera /base/axi/pcie@1000120000/rp1/i2c@80000/imx708@1a to CFE device /dev/media2 and ISP device /dev/media0 using PiSP variant BCM2712_D0
[2:13:27.228712608] [4857]  INFO Camera camera.cpp:1205 configuring streams: (0) 640x480-XBGR8888 (1) 1536x864-BGGR_PISP_COMP1
[2:13:27.228851257] [4863]  INFO RPI pisp.cpp:1483 Sensor: /base/axi/pcie@1000120000/rp1/i2c@80000/imx708@1a - Selected sensor format: 1536x864-SBGGR10_1X10 - Selected CFE format: 1536x864-PC1B
[2:13:27.233031865] [4857]  INFO Camera camera.cpp:1205 configuring streams: (0) 640x480-XBGR8888 (1) 2304x1296-BGGR_PISP_COMP1
[2:13:27.233171645] [4863]  INFO RPI pisp.cpp:1483 Sensor: /base/axi/pcie@1000120000/rp1/i2c@80000/imx708@1a - Selected sensor format: 2304x1296-SBGGR10_1X10 - Selected CFE format: 2304x1296-PC1B
[2:13:27.239365795] [4857]  INFO Camera camera.cpp:1205 configuring streams: (0) 640x480-XBGR8888 (1) 4608x2592-BGGR_PISP_COMP1
[2:13:27.239519764] [4863]  INFO RPI pisp.cpp:1483 Sensor: /base/axi/pcie@1000120000/rp1/i2c@80000/imx708@1a - Selected sensor format: 4608x2592-SBGGR10_1X10 - Selected CFE format: 4608x2592-PC1B
Available camera modes: 3
[2:13:27.251208796] [4857]  INFO Camera camera.cpp:1205 configuring streams: (0) 640x480-BGR888 (1) 1536x864-BGGR_PISP_COMP1
[2:13:27.251338295] [4863]  INFO RPI pisp.cpp:1483 Sensor: /base/axi/pcie@1000120000/rp1/i2c@80000/imx708@1a - Selected sensor format: 1536x864-SBGGR10_1X10 - Selected CFE format: 1536x864-PC1B
[2:13:27.255068703] [4870]  WARN IPARPI ipa_base.cpp:1392 Ctrl AeEnable is not handled.
✓ Camera initialized successfully

=== Initializing Face Detection ===

=== Finding Haar Cascade file ===
✗ Not found: /usr/share/opencv4/haarcascades/haarcascade_frontalface_default.xml
✗ Not found: /usr/share/opencv/haarcascades/haarcascade_frontalface_default.xml
✗ Not found: /usr/local/share/opencv4/haarcascades/haarcascade_frontalface_default.xml
✗ Not found: /usr/lib/python3/dist-packages/cv2/data/haarcascade_frontalface_default.xml
✗ Not found: ./haarcascade_frontalface_default.xml
✗ No cascade file found!
Cannot proceed without face detection
aisl@gateway-529:~/deepcare/sensors $ 

2025.06.07 tts error
aisl@gateway-529:~/deepcare/tts_stt $ python3 -m pip install pyttsx3
error: externally-managed-environment

× This environment is externally managed
╰─> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    For more information visit http://rptl.io/venv

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.


sensor error
(venv) aisl@gateway-529:~/deepcare/sensorunit $ python infrared_sensor.py
MQTT 설정 로드됨: localhost:1883
토픽 접두사: sensors
Traceback (most recent call last):
  File "/home/aisl/deepcare/sensorunit/infrared_sensor.py", line 145, in <module>
    sensor = InfraredSensor()
             ^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/sensorunit/infrared_sensor.py", line 28, in __init__
    GPIO.setup(INFRARED_PIN, GPIO.IN)
RuntimeError: Cannot determine SOC peripheral base address

----
aisl@gateway-529:~/deepcare/sensorunit $ python infrared_sensor.py
  File "/home/aisl/deepcare/sensorunit/infrared_sensor.py", line 73
    global IS_RASPBERRY_PI
    ^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: name 'IS_RASPBERRY_PI' is used prior to global declaration

-------------------------
(venv) aisl@gateway-529:~/deepcare/sensorunit $ python dht_sensor.py
✓ RPi.GPIO 라이브러리 사용 (이전 라즈베리파이 호환)
⚠️ DHT 라이브러리를 찾을 수 없습니다. Mock 데이터를 사용합니다.
MQTT 설정 로드됨: localhost:1883
토픽 접두사: sensors
🔧 Mock 모드: 온습도 센서 시뮬레이션 (GPIO 22)
🔄 MQTT 브로커 연결 중: localhost:1883...
✗ MQTT 연결 오류: [Errno 111] Connection refused
✗ MQTT 연결 실패
🛑 온습도 센서 모니터링 중지

(venv) aisl@gateway-529:~/deepcare/sensorunit $ python sound_sensor.py
✓ RPi.GPIO 라이브러리 사용 (이전 라즈베리파이 호환)
MQTT 설정 로드됨: localhost:1883
토픽 접두사: sensors
✗ GPIO 초기화 실패: Cannot determine SOC peripheral base address
⚠️ Mock 모드로 전환합니다.
🔄 MQTT 브로커 연결 중: localhost:1883...
✗ MQTT 연결 오류: [Errno 111] Connection refused
✗ MQTT 연결 실패
🛑 소음 센서 모니터링 중지

(venv) aisl@gateway-529:~/deepcare/sensorunit $ python infrared_sensor.py
✓ RPi.GPIO 라이브러리 사용 (이전 라즈베리파이 호환)
MQTT 설정 로드됨: localhost:1883
토픽 접두사: sensors
✗ GPIO 초기화 실패: Cannot determine SOC peripheral base address
⚠️ Mock 모드로 전환합니다.
🔄 MQTT 브로커 연결 중: localhost:1883...
✗ MQTT 연결 오류: [Errno 111] Connection refused
✗ MQTT 연결 실패
🛑 적외선 센서 모니터링 중지

----------------
06.09
(venv) aisl@gateway-529:~/deepcare/sensor $ python3 rpi5-infrared-sensor-simple.py
MQTT 설정 로드됨: localhost:1883
토픽 접두사: sensors
Traceback (most recent call last):
  File "/home/aisl/deepcare/sensor/rpi5-infrared-sensor-simple.py", line 161, in <module>
    sensor = InfraredSensorRPi5()
             ^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/sensor/rpi5-infrared-sensor-simple.py", line 41, in __init__
    config = gpiod.line_request()
             ^^^^^^^^^^^^^^^^^^
AttributeError: module 'gpiod' has no attribute 'line_request'
----------------------
(venv) aisl@gateway-529:~/deepcare/sensor $ python3 rpi5-dht-sensor-simple.py
Traceback (most recent call last):
  File "/home/aisl/deepcare/sensor/rpi5-dht-sensor-simple.py", line 13, in <module>
    import board
ModuleNotFoundError: No module named 'board'

---------
06.10 display error
(venv) aisl@gateway-529:~/deepcare $ uname -r
6.12.25+rpt-rpi-2712
(venv) aisl@gateway-529:~/deepcare $ ls /lib/modules/$(uname -r)/kernel/drivers/staging/fbtft/
fb_agm1264k-fl.ko.xz  fb_ili9325.ko.xz  fb_s6d1121.ko.xz  fbtft.ko.xz
fb_bd663474.ko.xz     fb_ili9340.ko.xz  fb_sh1106.ko.xz   fb_tinylcd.ko.xz
fb_hx8340bn.ko.xz     fb_ili9341.ko.xz  fb_ssd1289.ko.xz  fb_tls8204.ko.xz
fb_hx8347d.ko.xz      fb_ili9481.ko.xz  fb_ssd1306.ko.xz  fb_uc1611.ko.xz
fb_hx8353d.ko.xz      fb_ili9486.ko.xz  fb_ssd1331.ko.xz  fb_uc1701.ko.xz
fb_hx8357d.ko.xz      fb_pcd8544.ko.xz  fb_ssd1351.ko.xz  fb_upd161704.ko.xz
fb_ili9163.ko.xz      fb_ra8875.ko.xz   fb_st7735r.ko.xz
fb_ili9320.ko.xz      fb_s6d02a1.ko.xz  fb_st7789v.ko.xz
(venv) aisl@gateway-529:~/deepcare $ lsmod | grep spi
spidev                 49152  0
spi_bcm2835            49152  0
spi_dw_mmio            49152  0
spi_dw                 49152  1 spi_dw_mmio
(venv) aisl@gateway-529:~/deepcare $ lsmod | grep fbtft
-----
 aisl@gateway-529:~/deepcare $ python3 gpiotest.py
Traceback (most recent call last):
  File "/home/aisl/deepcare/gpiotest.py", line 7, in <module>
    serial = spi(port=0, device=0, gpio_DC=24, gpio_RST=25, 
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/venv/lib/python3.11/site-packages/luma/core/interface/serial.py", line 302, in __init__
    bitbang.__init__(self, gpio, transfer_size, reset_hold_time, reset_release_time, DC=gpio_DC, RST=gpio_RST)
  File "/home/aisl/venv/lib/python3.11/site-packages/luma/core/interface/serial.py", line 190, in __init__
    self._DC = self._configure(kwargs.get("DC"))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/venv/lib/python3.11/site-packages/luma/core/interface/serial.py", line 203, in _configure
    self._gpio.setup(pin, self._gpio.OUT)
RuntimeError: Cannot determine SOC peripheral base address

-----------------------------------------------------
File "/home/aisl/deepcare/raspberrypi5/scripts/launch_full_pipeline.py", line 28, in <module>
    from features.biometric.thermal_rppg_enhanced import EnhancedThermalrPPGSystem, ThermalrPPGConfig, ProcessingMode
  File "/home/aisl/deepcare/raspberrypi5/features/biometric/thermal_rppg_enhanced.py", line 3, in <module>
    import torch
ModuleNotFoundError: No module named 'torch'

-------------------------------------------------------------

e slave format for 'plug:hw'
ALSA lib pcm_plug.c:839:(snd_pcm_plug_hw_refine_schange) Format: S16_LE
ALSA lib pcm_plug.c:844:(snd_pcm_plug_hw_refine_schange) Slave format: IEC958_SUBFRAME_LE
ALSA lib pcm_plug.c:924:(snd_pcm_plug_hw_refine_cchange) Unable to find an usable client format
ALSA lib pcm_plug.c:928:(snd_pcm_plug_hw_refine_cchange) Format: S16_LE
ALSA lib pcm_plug.c:933:(snd_pcm_plug_hw_refine_cchange) Slave format: IEC958_SUBFRAME_LE
ALSA lib pcm_plug.c:835:(snd_pcm_plug_hw_refine_schange) Unable to find an usable slave format for 'plug:hw'
ALSA lib pcm_plug.c:839:(snd_pcm_plug_hw_refine_schange) Format: S16_LE
ALSA lib pcm_plug.c:844:(snd_pcm_plug_hw_refine_schange) Slave format: IEC958_SUBFRAME_LE
ALSA lib pcm_plug.c:924:(snd_pcm_plug_hw_refine_cchange) Unable to find an usable client format
ALSA lib pcm_plug.c:928:(snd_pcm_plug_hw_refine_cchange) Format: S16_LE
ALSA lib pcm_plug.c:933:(snd_pcm_plug_hw_refine_cchange) Slave format: IEC958_SUBFRAME_LE
ALSA lib confmisc.c:160:(snd_config_get_card) Invalid field card
ALSA lib pcm_usb_stream.c:482:(_snd_pcm_usb_stream_open) Invalid card 'card'
ALSA lib confmisc.c:160:(snd_config_get_card) Invalid field card
ALSA lib pcm_usb_stream.c:482:(_snd_pcm_usb_stream_open) Invalid card 'card'
ALSA lib pcm_direct.c:1258:(snd1_pcm_direct_initialize_slave) requested or auto-format is not available
ALSA lib pcm_dmix.c:1011:(snd_pcm_dmix_open) unable to initialize slave
Cannot connect to server socket err = No such file or directory
Cannot connect to server request channel
jack server is not running or cannot be started
JackShmReadWritePtr::~JackShmReadWritePtr - Init not done for -1, skipping unlock
JackShmReadWritePtr::~JackShmReadWritePtr - Init not done for -1, skipping unlock
2025-08-13 12:01:30 [INFO] TTSSTTManager: ✅ STT 초기화 성공 (마이크: 6개)
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:30 [INFO] kafka.consumer.subscription_state: Updating subscribed topics to: ('audio-commands',)
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:30 [INFO] TTSSTTManager: TTS/STT 매니저 초기화 완료
2025-08-13 12:01:30 [INFO] TTSSTTManager: 🎧 카프카 명령 수신 시작
2025-08-13 12:01:30 [INFO] TTSSTTManager: ✅ TTS/STT 매니저 시작됨
2025-08-13 12:01:30 [INFO] PipelineManager: ✅ 서비스 시작 완료: tts_stt_system
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 12:01:30 [INFO] kafka.cluster: Coordinator for group/tts-stt-manager is BrokerMetadata(nodeId='coordinator-1', host='localhost', port=9092, rack=None)
2025-08-13 12:01:30 [INFO] kafka.coordinator: Discovered coordinator coordinator-1 for group tts-stt-manager
2025-08-13 12:01:30 [INFO] kafka.coordinator.heartbeat: Starting new heartbeat thread
2025-08-13 12:01:30 [INFO] kafka.coordinator.consumer: Revoking previously assigned partitions set() for group tts-stt-manager
2025-08-13 12:01:30 [INFO] kafka.coordinator: Failed to join group tts-stt-manager: NodeNotReadyError: coordinator-1
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:30 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:30 [INFO] kafka.coordinator: (Re-)joining group tts-stt-manager
2025-08-13 12:01:30 [INFO] kafka.coordinator: Received member id raspberrypi5-pipeline-consumer-a50f3db7-22d4-46af-ac3c-075dc8f84dac for group tts-stt-manager; will retry join-group
2025-08-13 12:01:30 [INFO] kafka.coordinator: Failed to join group tts-stt-manager: [Error 79] MemberIdRequiredError
2025-08-13 12:01:30 [INFO] kafka.coordinator: (Re-)joining group tts-stt-manager
2025-08-13 12:01:30 [INFO] kafka.coordinator: Successfully joined group tts-stt-manager <Generation 10 (member_id: raspberrypi5-pipeline-consumer-a50f3db7-22d4-46af-ac3c-075dc8f84dac, protocol: range)>
2025-08-13 12:01:30 [INFO] kafka.coordinator: Elected group leader -- performing partition assignments using range
2025-08-13 12:01:30 [INFO] kafka.consumer.subscription_state: Updated partition assignment: [TopicPartition(topic='audio-commands', partition=0)]
2025-08-13 12:01:30 [INFO] kafka.coordinator.consumer: Setting newly assigned partitions {TopicPartition(topic='audio-commands', partition=0)} for group tts-stt-manager
2025-08-13 12:01:31 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'detection_time': 1755086491, 'type': 'motion_alert', 'value': True, 'timestamp': 1755086491}
2025-08-13 12:01:31 [WARNING] ThresholdEventProcessor: 🚶 움직임 감지됨 (감지시간: 1755086491)
2025-08-13 12:01:31 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: motion_alert
2025-08-13 12:01:32 [INFO] PipelineManager: 서비스 시작: rppg_camera
2025-08-13 12:01:32 [ERROR] PipelineManager: ❌ 서비스 rppg_camera 시작 오류: REALTIME
2025-08-13 12:01:32 [ERROR] PipelineManager: 필수 서비스 rppg_camera 시작 실패
2025-08-13 12:01:32 [INFO] PipelineManager: 서비스 시작: event_processor
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:32 [INFO] kafka.consumer.subscription_state: Updating subscribed topics to: ('sensor-events', 'thermal-camera-raw', 'thermal-alerts', 'audio-input', 'audio-commands', 'audio-alerts')
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-08-13 12:01:32 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 12:01:32 [ERROR] PipelineManager: ❌ 서비스 event_processor 시작 오류: 'EventProcessor' object has no attribute 'setup_response_rules'
2025-08-13 12:01:32 [ERROR] PipelineManager: 필수 서비스 event_processor 시작 실패
2025-08-13 12:01:32 [INFO] PipelineManager: 서비스 시작: basic_display
2025-08-13 12:01:32 [INFO] PipelineManager: ✅ 서비스 시작 완료: basic_display
/home/aisl/deepcare/venv/lib/python3.11/site-packages/pygame/pkgdata.py:25: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  from pkg_resources import resource_stream, resource_exists
pygame 2.6.1 (SDL 2.28.4, Python 3.11.2)
Hello from the pygame community. https://www.pygame.org/contribute.html
2025-08-13 12:01:34 [INFO] PipelineManager: 서비스 시작: conversation_display
2025-08-13 12:01:34 [INFO] PipelineManager: ✅ 서비스 시작 완료: conversation_display
/home/aisl/deepcare/venv/lib/python3.11/site-packages/pygame/pkgdata.py:25: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  from pkg_resources import resource_stream, resource_exists
pygame 2.6.1 (SDL 2.28.4, Python 3.11.2)
Hello from the pygame community. https://www.pygame.org/contribute.html
Traceback (most recent call last):
  File "/home/aisl/deepcare/raspberrypi5/features/display/conversation_display.py", line 471, in <module>
    display = ConversationDisplay()
              ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/raspberrypi5/features/display/conversation_display.py", line 140, in __init__
    self.init_kafka()
  File "/home/aisl/deepcare/raspberrypi5/features/display/conversation_display.py", line 144, in init_kafka
    if not KAFKA_ENABLED:
           ^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'KAFKA_ENABLED' where it is not associated with a value
2025-08-13 12:01:36 [INFO] PipelineManager: 서비스 모니터링 시작
2025-08-13 12:01:36 [ERROR] PipelineManager: ❌ 파이프라인 부분 시작 (5/7)
❌ 파이프라인 시작 실패
로그를 확인하세요: pipeline_manager.log
2025-08-13 12:01:36 [INFO] PipelineManager: 🛑 전체 파이프라인 중지
2025-08-13 12:01:36 [INFO] PipelineManager: ============================================================
2025-08-13 12:01:36 [INFO] PipelineManager: 📊 시스템 상태: ERROR
2025-08-13 12:01:36 [INFO] PipelineManager: ------------------------------------------------------------
2025-08-13 12:01:36 [INFO] PipelineManager: 🟢 kafka_broker: running (12s)
2025-08-13 12:01:36 [INFO] PipelineManager: 🔴 rppg_camera: error [오류: 1]
2025-08-13 12:01:36 [INFO] PipelineManager: 🟢 tts_stt_system: running (8s)
2025-08-13 12:01:36 [INFO] PipelineManager: 🟢 uart_processor: running (10s)
2025-08-13 12:01:36 [INFO] PipelineManager: 🔴 event_processor: error [오류: 1]
2025-08-13 12:01:36 [INFO] PipelineManager: 🟢 basic_display: running (4s)
2025-08-13 12:01:36 [INFO] PipelineManager: 🟢 conversation_display: running (2s)
2025-08-13 12:01:36 [INFO] PipelineManager: ============================================================
2025-08-13 12:01:37 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'detection_time': 1755086497, 'type': 'motion_alert', 'value': True, 'timestamp': 1755086497}
2025-08-13 12:01:37 [WARNING] ThresholdEventProcessor: 🚶 움직임 감지됨 (감지시간: 1755086497)
2025-08-13 12:01:37 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: motion_alert
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'value': {'timestamp': 1755086499, 'climate': {'status': 'ok', 'humidity': 57.0, 'temperature': 25.5}, 'noise_level': 0.59, 'motion_detected': True, 'air_quality': {'message': '[Errno 5] EIO', 'status': 'error'}}, 'type': 'sensor_data', 'timestamp': 1755086499}
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor: 📊 센서 데이터 수신:
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor:   🔊 소음: 0.59%
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor:   🚶 움직임: 감지
2025-08-13 12:01:39 [WARNING] ThresholdEventProcessor:   🌫️ 미세먼지: 데이터 없음
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor:   🌡️ 온도: 25.5°C
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor:   💧 습도: 57.0%
2025-08-13 12:01:39 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: sensor_data
2025-08-13 12:01:43 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'detection_time': 1755086503, 'type': 'motion_alert', 'value': True, 'timestamp': 1755086503}
2025-08-13 12:01:43 [WARNING] ThresholdEventProcessor: 🚶 움직임 감지됨 (감지시간: 1755086503)
2025-08-13 12:01:43 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: motion_alert
2025-08-13 12:01:46 [INFO] PipelineManager: 서비스 중지: conversation_display
2025-08-13 12:01:46 [INFO] PipelineManager: ✅ 서비스 중지 완료: conversation_display
2025-08-13 12:01:47 [INFO] PipelineManager: 서비스 중지: basic_display
2025-08-13 12:01:47 [INFO] PipelineManager: ✅ 서비스 중지 완료: basic_display
2025-08-13 12:01:48 [INFO] PipelineManager: 서비스 중지: event_processor
2025-08-13 12:01:48 [INFO] PipelineManager: ✅ 서비스 중지 완료: event_processor
2025-08-13 12:01:49 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'detection_time': 1755086509, 'type': 'motion_alert', 'value': True, 'timestamp': 1755086509}
2025-08-13 12:01:49 [WARNING] ThresholdEventProcessor: 🚶 움직임 감지됨 (감지시간: 1755086509)
2025-08-13 12:01:49 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: motion_alert
2025-08-13 12:01:49 [INFO] PipelineManager: 서비스 중지: rppg_camera
2025-08-13 12:01:49 [INFO] PipelineManager: ✅ 서비스 중지 완료: rppg_camera
2025-08-13 12:01:50 [INFO] PipelineManager: 서비스 중지: tts_stt_system
2025-08-13 12:01:50 [INFO] TTSSTTManager: 🛑 TTS/STT 매니저 중지 중...
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'value': {'timestamp': 1755086510, 'climate': {'status': 'ok', 'humidity': 56.9, 'temperature': 25.4}, 'noise_level': 1.0, 'motion_detected': True, 'air_quality': {'message': '[Errno 5] EIO', 'status': 'error'}}, 'type': 'sensor_data', 'timestamp': 1755086510}
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor: 📊 센서 데이터 수신:
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor:   🔊 소음: 1.0%
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor:   🚶 움직임: 감지
2025-08-13 12:01:50 [WARNING] ThresholdEventProcessor:   🌫️ 미세먼지: 데이터 없음
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor:   🌡️ 온도: 25.4°C
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor:   💧 습도: 56.9%
2025-08-13 12:01:50 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: sensor_data
2025-08-13 12:01:55 [INFO] ThresholdEventProcessor: 🎯 임계값 이벤트 수신: {'detection_time': 1755086515, 'type': 'motion_alert', 'value': True, 'timestamp': 1755086515}
2025-08-13 12:01:55 [WARNING] ThresholdEventProcessor: 🚶 움직임 감지됨 (감지시간: 1755086515)
2025-08-13 12:01:55 [INFO] ThresholdEventProcessor: 📤 Kafka 전송 완료: motion_alert
2025-08-13 12:01:55 [ERROR] TTSSTTManager: ❌ 명령 처리 루프 오류: KafkaConsumer is closed
2025-08-13 12:01:55 [INFO] kafka.coordinator.heartbeat: Stopping heartbeat thread
2025-08-13 12:01:55 [INFO] kafka.coordinator: Leaving consumer group (tts-stt-manager).
2025-08-13 12:01:55 [INFO] kafka.coordinator: LeaveGroup request for group tts-stt-manager returned successfully
2025-08-13 12:01:55 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 12:01:55 [INFO] kafka.consumer.fetcher: Fetch to node 1 failed: Cancelled: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>
2025-08-13 12:01:55 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 12:01:55 [INFO] kafka.producer.kafka: <KafkaProducer client_id=raspberrypi5-pipeline-producer transactional_id=None>: Closing the Kafka producer with 9223372036.0 secs timeout.
2025-08-13 12:01:55 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 12:01:55 [INFO] TTSSTTManager: 📊 TTS/STT 통계:
2025-08-13 12:01:55 [INFO] TTSSTTManager:   TTS 요청: 0
2025-08-13 12:01:55 [INFO] TTSSTTManager:   STT 요청: 0
2025-08-13 12:01:55 [INFO] TTSSTTManager:   성공적 인식: 0
2025-08-13 12:01:55 [INFO] TTSSTTManager:   오류 발생: 0
2025-08-13 12:01:55 [INFO] TTSSTTManager: ✅ TTS/STT 매니저 중지됨
2025-08-13 12:01:55 [INFO] PipelineManager: ✅ 서비스 중지 완료: tts_stt_system
2025-08-13 12:01:56 [INFO] PipelineManager: 서비스 중지: uart_processor
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 🧹 리소스 정리 중...
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: ✅ 직렬 포트 닫음
2025-08-13 12:01:56 [ERROR] ThresholdEventProcessor: ❌ 예상치 못한 오류: 'NoneType' object cannot be interpreted as an integer
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 🧹 리소스 정리 중...
2025-08-13 12:01:56 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-producer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: ✅ Kafka Producer 닫음
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: ✅ Kafka Producer 닫음
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 📊 통계: 총수신=8, 필터됨=8, Kafka전송=8, 오류=0
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 📊 통계: 총수신=8, 필터됨=8, Kafka전송=8, 오류=0
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 👋 프로그램 종료
2025-08-13 12:01:56 [INFO] ThresholdEventProcessor: 👋 프로그램 종료
2025-08-13 12:01:56 [INFO] PipelineManager: ✅ 서비스 중지 완료: uart_processor
2025-08-13 12:01:57 [INFO] PipelineManager: 서비스 중지: kafka_broker
Failed to stop kafka.service: Unit kafka.service not loaded.
Failed to stop zookeeper.service: Unit zookeeper.service not loaded.
-------------------------------------------------------------------------
(venv) aisl@gateway-529:~/deepcare/raspberrypi5/features/display $ python3 display_manager.py
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 16:35:54 [INFO] kafka.consumer.subscription_state: Updating subscribed topics to: ('display-control',)
2025-08-13 16:35:54 [INFO] DisplayManager: ✅ 디스플레이 매니저 Kafka 초기화 완료
==================================================
🖥️ 디스플레이 매니저 상태
==================================================
current_display: sensor
process_running: False
process_pid: None
uptime: 0.006794452667236328
mode_switches: 0
last_switch_ago: None
available_displays: ['sensor', 'conversation', 'video']
==================================================
2025-08-13 16:35:54 [INFO] DisplayManager: 🚀 디스플레이 매니저 시작
2025-08-13 16:35:54 [INFO] DisplayManager: 📋 사용 가능한 디스플레이: ['sensor', 'conversation', 'video']
2025-08-13 16:35:54 [INFO] DisplayManager: 🏠 기본 디스플레이: sensor
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 16:35:54 [INFO] kafka.cluster: Coordinator for group/display-manager-group is BrokerMetadata(nodeId='coordinator-1', host='localhost', port=9092, rack=None)
2025-08-13 16:35:54 [INFO] kafka.coordinator: Discovered coordinator coordinator-1 for group display-manager-group
2025-08-13 16:35:54 [INFO] kafka.coordinator.heartbeat: Starting new heartbeat thread
2025-08-13 16:35:54 [INFO] kafka.coordinator.consumer: Revoking previously assigned partitions set() for group display-manager-group
2025-08-13 16:35:54 [INFO] kafka.coordinator: Failed to join group display-manager-group: NodeNotReadyError: coordinator-1
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-08-13 16:35:54 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-08-13 16:35:54 [INFO] kafka.coordinator: (Re-)joining group display-manager-group
2025-08-13 16:35:54 [INFO] kafka.coordinator: Received member id raspberrypi5-pipeline-consumer-d2dfb0b6-16a4-43bd-a8d9-f9b2eb14d02d for group display-manager-group; will retry join-group
2025-08-13 16:35:54 [INFO] kafka.coordinator: Failed to join group display-manager-group: [Error 79] MemberIdRequiredError
2025-08-13 16:35:54 [INFO] kafka.coordinator: (Re-)joining group display-manager-group
2025-08-13 16:35:59 [INFO] kafka.coordinator: Successfully joined group display-manager-group <Generation 8 (member_id: raspberrypi5-pipeline-consumer-d2dfb0b6-16a4-43bd-a8d9-f9b2eb14d02d, protocol: range)>
2025-08-13 16:35:59 [INFO] kafka.consumer.subscription_state: Updated partition assignment: []
2025-08-13 16:35:59 [INFO] kafka.coordinator.consumer: Setting newly assigned partitions set() for group display-manager-group
^C2025-08-13 16:36:12 [INFO] DisplayManager: 🛑 사용자에 의해 중단됨
2025-08-13 16:36:12 [INFO] DisplayManager: 🧹 디스플레이 매니저 리소스 정리 중...
2025-08-13 16:36:12 [INFO] kafka.coordinator.heartbeat: Stopping heartbeat thread
Exception in thread Thread-1 (kafka_consumer_loop):
Traceback (most recent call last):
  File "/usr/lib/python3.11/threading.py", line 1038, in _bootstrap_inner
2025-08-13 16:36:13 [INFO] kafka.coordinator: Leaving consumer group (display-manager-group).
    self.run()
  File "/usr/lib/python3.11/threading.py", line 975, in run
    self._target(*self._args, **self._kwargs)
  File "/home/aisl/deepcare/raspberrypi5/features/display/display_manager.py", line 115, in kafka_consumer_loop
    for message in self.consumer:
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/kafka/consumer/group.py", line 1188, in __next__
    return next(self._iterator)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/kafka/consumer/group.py", line 1160, in _message_generator_v2
    record_map = self.poll(timeout_ms=timeout_ms, update_offsets=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/kafka/consumer/group.py", line 679, in poll
2025-08-13 16:36:13 [INFO] kafka.coordinator: LeaveGroup request for group display-manager-group returned successfully
    assert not self._closed, 'KafkaConsumer is closed'
AssertionError: KafkaConsumer is closed
2025-08-13 16:36:13 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-08-13 16:36:13 [INFO] kafka.conn: <BrokerConnection client_id=raspberrypi5-pipeline-consumer, node_id=coordinator-1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 

_______________________________________________________________________

[i] TTS waiting on topic 'tts.text' ... (model=unset)
/home/aisl/deepcare/venv/lib/python3.11/site-packages/webrtcvad.py:1: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
[i] Loading faster-whisper: small-int8 (lang=ko, precision=int8)
Traceback (most recent call last):
  File "/home/aisl/deepcare/raspberrypi5/features/conversation/stt_whisper_local.py", line 100, in <module>
    model = WhisperModel(MODEL_SIZE, device="cpu", compute_type=PRECISION)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/faster_whisper/transcribe.py", line 127, in __init__
    model_path = download_model(
                 ^^^^^^^^^^^^^^^
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/faster_whisper/utils.py", line 76, in download_model
    raise ValueError(
ValueError: Invalid model size 'small-int8', expected one of: tiny.en, tiny, base.en, base, small.en, small, medium.en, medium, large-v1, large-v2, large-v3, large, distil-large-v2, distil-medium.en, distil-small.en
[!] Child exited with code 1: ['/home/aisl/deepcare/venv/bin/python3', '/home/aisl/deepcare/raspberrypi5/features/conversation/stt_whisper_local.py']
----------------------------------------------------------------------------------------
Expression 'paTimedOut' failed in 'src/os/unix/pa_unix_util.c', line: 387
Expression 'PaUnixThread_New( &stream->thread, &CallbackThreadFunc, stream, 1., stream->rtSched )' failed in 'src/hostapi/alsa/pa_linux_alsa.c', line: 2998
Traceback (most recent call last):
  File "/home/aisl/deepcare/raspberrypi5/features/conversation/stt_whisper_local.py", line 269, in <module>
    run()
  File "/home/aisl/deepcare/raspberrypi5/features/conversation/stt_whisper_local.py", line 249, in run
    with Stream(
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/sounddevice.py", line 1106, in __enter__
    self.start()
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/sounddevice.py", line 1124, in start
    _check(err, 'Error starting stream')
  File "/home/aisl/deepcare/venv/lib/python3.11/site-packages/sounddevice.py", line 2804, in _check
    raise PortAudioError(errormsg, err)
sounddevice.PortAudioError: Error starting stream: Wait timed out [PaErrorCode -9987]
Expression 'pthread_join( self->thread, &pret )' failed in 'src/os/unix/pa_unix_util.c', line: 441
Expression 'PaUnixThread_Terminate( &stream->thread, !abort, &threadRes )' failed in 'src/hostapi/alsa/pa_linux_alsa.c', line: 3102
[!] Child exited with code 1: ['/home/aisl/deepcare/venv/bin/python3', '/home/aisl/deepcare/raspberrypi5/features/conversation/stt_whisper_local.py']


